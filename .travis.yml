language: ruby
rvm:
- 2.0.0
env:
  global:
    - secure: "Y/P5qutDXjh3OnHrR/pwu5kS3iPqnkSFg4X6zLeVb4Bmf6A4RPYoL8JbxdVOFoFNUsepzJuhVFEsqXHdKZzirJBsxAkrO9UeuT5+ytvDb/ggfBpyhOWpZyNJ/5W8I3JNzYERk9TD3CtP2dhjJlmau/UUD9FvjFeF0zSti5YiaCs="
before_script:
  - psql -c 'CREATE USER root with SUPERUSER;' -U postgres
  - psql -c 'CREATE DATABASE uk_postcodes_test;' -U postgres
  - psql -d uk_postcodes_test -c 'CREATE SCHEMA postgis; CREATE EXTENSION postgis WITH SCHEMA postgis;' -U postgres
  - bundle exec rake db:migrate
after_success:
  - "openssl aes-256-cbc -k '$DEPLOY_KEY' -in config/deploy_id_rsa_enc_travis -d -a -out config/deploy_id_rsa"
  - "[[ $TRAVIS_BRANCH = 'master' ]] && bundle exec cap production deploy"